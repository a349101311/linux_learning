# Linux用户和用户组管理

##  一、Linux系统用户账号的管理

1. 添加新的用户账号使用useradd命令，其语法如下：
   useradd [-cdgGsu] 用户名

   + -c comment 指定一段注释性描述
   + -d 目录 指定用户主目录，如果此目录不存在，则同时使用-m 选项，可以创建主目录
   + -g 用户组 指定用户所属的用户组
   + -G 用户组 指定用户所属的附加组
   + -s shell文件 指定用户的登录shell
   + -u 用户号 指定用户的用户号，如果同时又-o选项，则可以重复使用其他用户的标识号

   增加用户账号就是在/etc/passwd 文件中为新用户增加一条记录，同时更新其他系统文件如/etc/shadow，/etc/group等。

   Linux提供了集成的系统管理工具userconf，它可以用来对用户账号进行统一管理。

2. 删除账号
   删除账号就是把/etc/passwd等系统文件该用户的记录删除，必要时还会删除用户的主目录
   userdel [-r] 用户名
   常用的选项-r ，它的作用是把用户的主目录也一起删除

3. 修改账号
   usermod [选项 这里的选项和useradd的选项一样] 用户名

4. 用户口令的管理（密码）
   用户刚刚创建时候 必须为其指定口令才可以使用 哪怕是空指令
   指定和修改用户口令的Shell命令是 passwd，超级用户可以为自己和其他用户指定口令，普通用户只能用它修改自己的口令
   passwd [] 用户名

   - -l 锁定口令，即禁用账号
   - -u 口令解锁
   - -d 使账号无口令
   - -f 强迫用户下次登陆时修改口令

   为用户指定空口令时，执行 passwd -d 用户名

   锁定某个用户不能登陆 passwd -l 用户名


## 二、Linux系统用户组的设置

每个用户都有一个用户组，系统可以对一个用户组中的所有用户进行集中管理。组的增加、删除和修改实际上就是对/etc/group文件的更新。

+ 增加一个新的用户组使用groupadd命令

  groupadd [] 用户组名 -g GID 指定新用户 组的组标识号（GID） -o 一般与-g选项同时使用，表示新用户组的GID可以与系统已有用户组的GID相同

+ 删除一个已有的用户组groupdel 用户组

+ 修改用户组的属性使用groupmod命令
  groupmod [] 用户组名
  -g GID为用户组指定新的组标识号

  -o 与-g选项同时使用 与groupadd类似
  -n 新用组 改名用户组

+ 如果一个用户同时属于多个用户组，那么用户可以在用户组之间切换，以便具有其他用户组的权限
  用户可以在登录后，使用命令newgrp切换到其他用户组，这个命令的参数就是目的用户组
  newgrp root

## 三、与用户账号有关的系统文件

1. /etc/passwd文件是用户管理工作涉及的最重要的一个文件
   Linux系统中的每个用户都在/etc/passwd文件中有一个对应的记录行，它记录了这个用户的一些基本属性。这个文件对所有用户都是可读的，

   文件内容 每行被：分为七个字段，格式：

   用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell

   用户名：不用解释太多，命名规则注意不能有：，最好不要包含点字符.并且不使用连字符-和加号+打头

   口令：现在许多Linux系统都使用了shadow技术，把真正加密后的用户口令存放到/etc/shadow文件中

   用户标识号：通常用户标识号的取值为0-65535。0是超级用户root。1-99为系统保留

   组标识号：对应着/etc/group文件中的一条记录

   注释性描述：这个字段存放的是一段任意的注释性描述文字，用做finger命令的输出。

   主目录：用户登录到系统之后所处的目录。

   登录shell： shell是用户与linux系统之间的接口。linux的shell有许多在，每种都有不同的特点。系统管理员可以根据系统情况和用户习惯为用户指定某个shell，如果不指定shell，那么系统使用sh为默认的登录shell，即这个字段的值为/bin/sh

   系统中也有一类用户称为伪用户 pseudo users。这些用户在/etc/passed文件中也占有一条记录，但是不能记录。

2. /etc/shadow中的记录行与/etc/passwd中的一一对应，它由pwconv命令根据/etc/passed中的数据自动产生

   每行由若干字段 

   登录名:加密口令:最后一次修改时间:最小时间间隔:最大时间间隔:警告时间:不活动时间:失效时间:标志

3. 用户组的所有信息都存放在/etc/group中

   用户组的所有信息都存放在/etc/group文件中。此文件的格式也类似于/etc/passwd文件，由冒号(:)隔开若干个字段，这些字段有：
   组名:口令:组标识号:组内用户列表

## 四、添加批量用户

- 先编辑一个文本用户文件。
  每一列按照/etc/passwd密码文件的格式书写。一个范例：

  ```
  user001::600:100:user:/home/user001:/bin/bash
  user002::601:100:user:/home/user002:/bin/bash
  user003::602:100:user:/home/user003:/bin/bash
  user004::603:100:user:/home/user004:/bin/bash
  user005::604:100:user:/home/user005:/bin/bash
  user006::605:100:user:/home/user006:/bin/bash
  ```

- 以 root身份执行命令 /usr/sbin/newusers。从刚创建的用户文件user.txt中导入数据
  newusers < user.txt
  然后可以用 vipw 查看passwd是否已经出现这些用户的数据。

- 执行命令/usr/sbin/pwunconv将 `/etc/shadow` 产生的 `shadow` 密码解码，然后回写到 `/etc/passwd` 中，并将`/etc/shadow`的`shadow`密码栏删掉。这是为了方便下一步的密码转换工作，即先取消 `shadow password` 功能。

  ```
  # pwunconv
  ```

- 编辑每个用户的密码对照文件

- 以root命令执行命令/usr/sbin/chpasswd

- 确定密码经编码写入/etc/passed的密码栏